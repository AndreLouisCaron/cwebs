<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>cwebs: cwebs: WebSocket wire protocol, in C.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">cwebs&#160;<span id="projectnumber">0.2.1</span></div>
   <div id="projectbrief">WebSocket wire protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('index.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">cwebs: WebSocket wire protocol, in C. </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="abstract"></a>
Abstract</h2>
<p>This library provides facilities for processing WebSocket wire protocol frames. The parser is implemented as a finite state machine (FSM) for use in streaming applications (i.e. data arrives at an unpredictable rate and the parser must be interruptible). As such, the parser itself does not buffer any received data. It just forwards it to registered callbacks. It requires little overhead and is well suited for being used in an object-oriented wrapper.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a href="http://tools.ietf.org/html/rfc6455">http://tools.ietf.org/html/rfc6455</a></dd></dl>
<h2><a class="anchor" id="introduction"></a>
Introduction</h2>
<p>It defines a pair of structures <code><a class="el" href="structws__iwire.html" title="Incremental parser for WebSocket wire protocol (in-bound).">ws_iwire</a></code> and <code><a class="el" href="structws__owire.html" title="Incremental writer for WebSocket wire protocol (out-bound).">ws_owire</a></code> that respectively parse and emit WebSocket frames. The parsers implement only the low-level bit-twidling facilities and leave the HTTP parsing and networking code up to your application. This means you have to do a bit more work, but allows the library to be used in virtually any type of application, with any networking library, etc. When you receive data, feed it to the parser. When you want to reply, feed it to the emitter. Register a few callbacks to process decoded data and totrnasfer encoded data. Then, focus on your application.</p>
<p>To test the code, as well as to get you started on how to use the library, there are a few demo programs worth looking at. These demo programs are based on different frameworks, including native Win32 and UNIX APIs, as well as Qt.</p>
<h2><a class="anchor" id="how-to"></a>
How to use this library (overly simplified example)</h2>
<p>This mini how-to sample shows the key operations in a simple console chat application that reads text from standard input and sends the message over the websocket connection. Text messages received from the websocket are written to the standard output. This code uses a hypothetical I/O interface with descriptive function names to help focus on the calls involved with this library rather than a particular I/O library.</p>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> write_text ( ::<a class="code" href="structws__iwire.html" title="Incremental parser for WebSocket wire protocol (in-bound).">ws_iwire</a> * wire, <span class="keyword">const</span> <span class="keywordtype">void</span> * data, <a class="code" href="types_8h.html#a29940ae63ec06c9998bba873e25407ad" title="Unsigned 64-bit integer, 8 bytes.">uint64</a> size )
  {
      <span class="comment">// note that this callback would also be invoked for messages</span>
      <span class="comment">// containing binary data.  we&#39;ll assume the exact same code</span>
      <span class="comment">// is running on the other end.</span>

      <span class="comment">// 1: use &#39;wire-&gt;baton&#39; to recuperate standard output.</span>
      <span class="comment">// 2: write &#39;size&#39; bytes of UTF-8 text starting at &#39;data&#39;.</span>
  }

  <span class="keywordtype">void</span> flush_line ( ::<a class="code" href="structws__iwire.html" title="Incremental parser for WebSocket wire protocol (in-bound).">ws_iwire</a> * wire )
  {
      <span class="comment">// 1: use &#39;wire-&gt;baton&#39; to recuperate standard output.</span>
      <span class="comment">// 2: write newline character and flush output buffer.</span>
  }

  <span class="keywordtype">void</span> send_to_peer ( ::<a class="code" href="structws__owire.html" title="Incremental writer for WebSocket wire protocol (out-bound).">ws_owire</a> * wire, <span class="keyword">const</span> <span class="keywordtype">void</span> * data, <a class="code" href="types_8h.html#a29940ae63ec06c9998bba873e25407ad" title="Unsigned 64-bit integer, 8 bytes.">uint64</a> size )
  {
      <span class="comment">// 1: use &#39;wire-&gt;baton&#39; to recuperate socket object.</span>
      <span class="comment">// 2: send &#39;size&#39; bytes starting at &#39;data&#39;.</span>
  }

  <span class="keywordtype">int</span> main ( <span class="keywordtype">int</span>, <span class="keywordtype">char</span> ** )
  {
      <span class="comment">// connect socket, open streams, etc.</span>
      standard_input = ...;
      socket_object = ...;

      <span class="comment">// use external HTTP parser, base64, SA-11 and whatenot libraries</span>
      <span class="comment">// to implement the WebSocket handshake (not provided by this</span>
      <span class="comment">// library).  look at the complete demo programs for concrete</span>
      <span class="comment">// implementation using only light-weight open source libraries.</span>
      <span class="comment">// ...</span>

      <a class="code" href="iwire_8c.html#aada87a113d41141ad923ed52566ada8a" title="Initialize a parser.">ws_iwire_init</a>(&amp;iwire);
      iwire.baton          = &amp;standard_output;
      iwire.accept_content = &amp;write_text;
      iwire.end_message    = &amp;flush_line;

      <a class="code" href="owire_8c.html#a52f54d4ea07d0c80a41c29205341974c" title="Initialize a writer.">ws_owire_init</a>(&amp;owire);
      owire.baton          = &amp;socket_object;
      owire.accept_content = &amp;send_to_peer;

      <span class="comment">// simple buffer.</span>
      <span class="keywordtype">char</span> data[1024];

      <span class="keywordflow">while</span> (!exhausted(standard_input) ||
             !exhausted(socket_object))
      {
          wait_for_any(standard_input, socket_object);

          <span class="keywordflow">if</span> (can_read(standard_input)) {
             size = read(standard_input, data, <span class="keyword">sizeof</span>(data));
             <span class="comment">// (convert to UTF-8 if necessary)</span>
             <a class="code" href="owire_8c.html#a680704618a36e0283d42bd1e92226131" title="Send a full text message in a single call.">ws_owire_put_text</a>(&amp;owire, data, size);
          }

          <span class="keywordflow">if</span> (can_read(socket_object)) {
             size = read(socket_object, data, <span class="keyword">sizeof</span>(data));
             <span class="comment">// (convert from UTF-8 if necessary)</span>
             <a class="code" href="iwire_8c.html#a95676a7e0a6eda269600bd22670a0809" title="Consume available data and trigger appropriate application callbacks.">ws_iwire_feed</a>(&amp;iwire, data, size);
          }
      }
  }
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Feb 2 2012 23:22:16 for cwebs by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
